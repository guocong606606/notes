# 库表操作
### 字符串默认排序规则
+ mysql字符串默认排序不一致

1.  执行复杂语句，尤其是union时，易出现非法混合排序的问题（mix of collations）
2.  例如（utf8_genera_ci 和utf8_general_cs）两种排序方式前者大小写不敏感，后者大小写敏感，混合排序结果很可能不符合预期


+ 场景，使用pd设计表的时候，默认排序规则为：utf8mb4_0900_ai_ci；而库默认排序规则为：utf8mb4_unicode_ci


+ 方案：

```sql
-- 字符串类型数据排序规则修改
SELECT
	TABLE_SCHEMA '数据库',
	TABLE_NAME '表',
	COLUMN_NAME '字段',
	CHARACTER_SET_NAME '原字符集',
	IS_NULLABLE '非空属性',
	COLLATION_NAME '原排序规则',
	CONCAT(
	'ALTER TABLE ',
	TABLE_NAME,
	' MODIFY COLUMN ',
	COLUMN_NAME,
	' ',
	COLUMN_TYPE,
	' CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci',
	( CASE WHEN IS_NULLABLE = 'NO' THEN ' NOT NULL' ELSE '' END ),
	';' 
) '修正SQL' 
FROM
	information_schema.`COLUMNS` 
WHERE
	COLLATION_NAME RLIKE 'utf8mb4_0900_ai_ci' 
	AND TABLE_SCHEMA = 'qsc-v2-test';
```
+ mark：如数据库有外键设计，此方案不适用

----

### 查询表宽度（列数）

```mysql
select count(1) from information_schema.COLUMNS where TABLE_SCHEMA='库名' and table_name = '表名'
```

